# -*- coding: utf-8 -*-
"""
Created on Thu May  9 20:05:57 2019

@author: edgar
"""

from sharc.antenna.antenna import Antenna

import numpy as np


class AntennaRS1861_9C(Antenna):
    """
    Implements the reference antenna pattern described in Figure 9c from
    Recommendation ITU-R RS.1861.
    """

    def __init__(self):
        super().__init__()
        self.angle = np.linspace(-178.5, 173, 704)
        self.gain = np.array([
            -44.99, -45.02, -45.00, -44.90, -44.72, -44.58,
            -44.41, -44.19, -43.94, -43.64, -43.29, -42.88,
            -42.42, -41.91, -41.35, -40.76, -40.16, -39.58,
            -39.03, -38.53, -38.09, -37.37, -35.86, -36.22,
            -36.59, -35.48, -36.03, -37.46, -37.35, -37.14,
            -39.58, -40.71, -40.53, -40.53, -40.57, -40.61,
            -40.66, -41.51, -41.98, -42.50, -42.98, -43.37,
            -43.58, -42.34, -43.21, -44.54, -41.24, -40.92,
            -38.55, -42.53, -39.90, -39.94, -40.54, -41.38,
            -43.37, -43.09, -42.53, -42.46, -42.35, -42.17,
            -41.90, -41.51, -38.74, -39.84, -41.42, -42.00,
            -41.89, -41.54, -41.09, -40.65, -40.34, -40.54,
            -41.62, -42.07, -42.31, -42.49, -42.62, -42.70,
            -42.76, -42.61, -43.01, -43.62, -43.78, -43.91,
            -44.02, -44.10, -44.16, -44.18, -44.18, -44.22,
            -44.26, -44.30, -44.35, -44.40, -44.45, -44.48,
            -44.51, -44.53, -44.53, -44.51, -44.47, -44.41,
            -44.33, -44.24, -44.14, -44.03, -43.92, -43.41,
            -43.55, -44.00, -44.24, -44.25, -44.26, -44.25,
            -44.24, -44.23, -44.20, -44.17, -44.14, -44.11,
            -44.07, -44.04, -44.00, -43.96, -43.93, -43.89,
            -43.86, -43.84, -43.79, -43.51, -42.83, -44.48,
            -45.35, -43.95, -42.38, -41.08, -42.21, -43.02,
            -43.53, -43.54, -43.52, -42.96, -42.32, -41.92,
            -41.87, -41.97, -42.00, -40.43, -38.29, -37.30,
            -36.16, -34.96, -33.75, -32.62, -31.64, -30.80,
            -33.59, -37.23, -44.58, -43.50, -39.41, -37.12,
            -36.79, -37.05, -37.45, -37.52, -39.46, -38.97,
            -34.51, -31.88, -34.21, -36.81, -34.96, -34.09,
            -33.20, -32.80, -34.27, -34.46, -34.41, -34.69,
            -35.38, -35.40, -31.33, -28.54, -28.24, -34.10,
            -38.21, -36.14, -31.82, -27.22, -24.92, -25.85,
            -25.66, -25.61, -27.98, -27.19, -26.83, -26.97,
            -27.13, -25.93, -25.41, -24.69, -25.57, -26.66,
            -26.03, -24.96, -26.03, -27.23, -27.76, -28.49,
            -29.35, -30.31, -31.30, -32.65, -34.56, -34.14,
            -35.88, -37.02, -35.69, -34.56, -33.54, -33.55,
            -32.70, -29.91, -28.79, -27.74, -26.86, -25.98,
            -27.85, -27.84, -24.98, -28.11, -31.29, -34.43,
            -36.55, -32.95, -30.07, -30.52, -30.95, -31.31,
            -31.56, -31.64, -31.51, -31.12, -30.42, -29.22,
            -27.73, -26.09, -24.45, -22.97, -21.81, -21.11,
            -21.53, -23.84, -26.45, -25.60, -24.63, -22.21,
            -24.94, -21.85, -22.14, -22.42, -20.61, -18.24,
            -16.33, -15.85, -17.24, -17.36, -21.61, -25.45,
            -20.42, -22.94, -20.06, -14.79, -17.40, -13.46,
            -14.10, -12.54, -12.10, -11.62, -11.11, -10.57,
            -10.02, -9.48, -8.94, -8.43, -7.95, -7.51,
            -7.13, -6.82, -6.88, -8.11, -11.17, -12.35,
            -13.68, -15.07, -16.43, -17.68, -18.74, -19.52,
            -19.96, -19.84, -19.13, -18.08, -16.97, -16.07,
            -16.00, -15.08, -13.85, -12.46, -11.17, -10.27,
            -10.03, -10.73, -12.37, -14.68, -17.33, -20.03,
            -22.47, -25.97, -24.22, -25.91, -27.09, -26.43,
            -19.74, -10.09, -7.06, -7.26, -8.66, -10.51,
            -9.71, -8.90, -7.64, -5.13, -4.77, -4.60,
            -4.54, -5.12, -9.01, -10.72, -8.52, -5.68,
            -5.16, -4.34, -4.88, -3.50, 0.30, 4.92,
            9.96, 15.04, 19.76, 23.72, 28.78, 29.68, 31.00,
            32.00, 33.00, 34.40, 31.00, 28.90, 27.26, 24.64,
            23.74, 22.84, 19.39, 15.44, 12.15, 6.36, -1.75,
            -10.11, -15.67, -10.96, -5.37, -3.10, -3.68,
            -7.87, -17.43, -29.34, -22.33, -18.07, -23.14,
            -21.89, -33.38, -35.00, -20.28, -16.43, -16.20,
            -17.35, -19.21, -22.32, -22.40, -19.40, -15.77,
            -12.03, -10.67, -10.44, -9.31, -8.27, -8.38,
            -8.41, -12.85, -11.45, -9.65, -7.73, -6.21,
            -6.44, -6.82, -6.80, -6.15, -5.39, -6.53,
            -18.72, -12.85, -11.70, -11.42, -11.01, -10.63,
            -10.46, -10.66, -11.39, -13.65, -17.35, -21.36,
            -24.72, -25.50, -25.27, -25.88, -25.83, -22.67,
            -20.65, -20.56, -19.68, -18.80, -18.71, -19.78,
            -20.04, -20.58, -22.58, -24.90, -27.03, -29.09,
            -28.45, -28.31, -28.19, -32.10, -29.01, -20.88,
            -21.45, -24.33, -25.21, -25.52, -26.47, -33.62,
            -32.81, -22.49, -16.86, -17.71, -17.69, -17.52,
            -17.31, -17.21, -17.64, -18.96, -20.86, -22.82,
            -24.64, -25.87, -25.98, -26.26, -26.62, -26.98,
            -27.30, -27.49, -27.49, -27.24, -22.06, -26.26,
            -23.21, -20.29, -19.36, -19.03, -18.97, -18.89,
            -19.30, -20.33, -21.54, -22.91, -24.23, -26.67,
            -26.13, -25.47, -25.41, -25.04, -24.92, -24.99,
            -25.08, -25.21, -25.36, -25.53, -27.37, -29.54,
            -25.92, -26.72, -28.23, -28.74, -28.55, -28.00,
            -27.38, -27.88, -28.97, -30.21, -31.07, -29.28,
            -24.89, -23.30, -22.23, -22.09, -23.27, -24.93,
            -26.79, -27.61, -28.34, -28.00, -28.97, -30.84,
            -33.27, -36.07, -42.84, -28.77, -27.17, -28.22,
            -25.00, -24.41, -24.80, -24.70, -24.71, -25.87,
            -26.70, -27.72, -28.93, -30.34, -32.52, -36.41,
            -39.71, -41.12, -40.40, -38.97, -33.59, -36.20,
            -34.81, -33.93, -32.75, -31.40, -29.99, -28.66,
            -26.95, -30.14, -28.23, -29.60, -31.93, -32.96,
            -40.79, -43.19, -42.76, -42.01, -41.19, -40.35,
            -39.46, -38.40, -37.03, -34.78, -32.51, -32.41,
            -31.74, -30.93, -31.91, -33.37, -35.39, -38.52,
            -39.64, -40.78, -41.82, -43.07, -41.41, -40.59,
            -39.60, -38.30, -36.87, -35.52, -34.33, -34.59,
            -35.14, -35.70, -36.24, -36.69, -37.01, -36.38,
            -40.25, -39.16, -40.97, -41.71, -40.35, -38.54,
            -37.17, -39.18, -39.07, -38.28, -36.92, -35.11,
            -33.70, -33.14, -35.18, -37.16, -39.40, -41.61,
            -43.46, -44.75, -43.97, -41.15, -41.18, -37.08,
            -39.43, -38.04, -38.53, -38.68, -38.76, -38.88,
            -38.86, -38.39, -38.96, -39.76, -39.18, -38.34,
            -37.39, -36.59, -36.15, -36.35, -37.51, -39.28,
            -41.21, -42.86, -43.65, -43.99, -44.06, -43.93,
            -43.64, -43.26, -42.83, -41.59, -43.01, -44.55,
            -44.87, -45.05, -45.13, -45.13, -45.08, -45.01,
            -44.96, -45.12, -43.85, -42.62, -42.87, -42.48,
            -41.70, -42.37, -43.00, -43.55, -43.82, -43.33,
            -40.58, -40.51, -34.91, -29.58, -32.33, -32.17,
            -31.31, -30.80, -31.71, -34.14, -37.80, -41.68,
            -44.42, -42.80, -41.95, -41.26, -40.40, -39.44,
            -38.48, -37.59, -36.87, -36.18, -36.64, -37.05,
            -38.90, -41.09, -43.16, -44.64, -45.12, -44.86,
            -44.13, -43.22, -42.38, -42.27, -42.06,
        ]),

    def calculate_gain(self, *args, **kwargs) -> np.array:
        """
        Calculate the antenna gain for the given off-axis angles.

        Parameters
        ----------
        *args : tuple
            Positional arguments (not used).
        **kwargs : dict
            Keyword arguments, expects 'off_axis_angle_vec'.

        Returns
        -------
        np.array
            Calculated antenna gain values.
        """
        phi = np.array(kwargs["off_axis_angle_vec"])
        phi = np.maximum(phi, -178.5)
        phi = np.minimum(phi, 173)

        gain = np.interp(phi, self.angle, self.gain[0])

        return gain


if __name__ == '__main__':
    import matplotlib.pyplot as plt

    phi = np.linspace(-180, 180, num=1000)

    antenna = AntennaRS1861_9C()

    gain = antenna.calculate_gain(off_axis_angle_vec=phi)

    fig = plt.figure(
        figsize=(8, 5), facecolor='w',
        edgecolor='k',
    )  # create a figure object
    plt.plot(phi, gain, "-b")

    plt.title("ITU-R RS.1861 Fig 9c antenna radiation pattern")
    plt.xlabel(r"Off-axis angle $\phi$ [deg]")
    plt.ylabel("Antenna gain [dBi]")
    plt.xlim((phi[0], phi[-1]))
    plt.ylim((-50, 40))

    plt.grid()
    plt.show()
